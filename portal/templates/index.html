{% extends "base.html" %}
{% block title %}Enterra ‚Äî –õ–µ–Ω—Ç–∞{% endblock %}

{% block content %}
  {% if recommended_posts and current_user.is_authenticated %}
    <div class="portal-panel portal-glow p-3 p-lg-4 mb-4">
      <div class="d-flex align-items-center gap-2 mb-2">
        <span class="fs-4">‚ú®</span>
        <div class="fw-bold">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –≤–∞—Å</div>
      </div>
      <div class="text-secondary small mb-3">–ü–æ—Å—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–∏—Ö –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π</div>
      
      <div class="d-flex flex-column gap-3">
        {% for post in recommended_posts %}
          <div class="portal-card-horizontal position-relative">
            <div class="d-flex gap-0">
              <!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å: –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ —ç–º–æ–¥–∑–∏ -->
              <div class="portal-card-image-wrapper flex-shrink-0 position-relative">
                {% if post.media_path and post.media_type != "video" %}
                  <img src="{{ url_for('static', filename=post.media_path) }}" alt="{{ post.title }}" class="portal-card-image">
                {% else %}
                  <div class="portal-card-emoji-wrapper">
                    <div class="portal-card-emoji">{{ post.cover_emoji or "‚ú®" }}</div>
                  </div>
                {% endif %}
              </div>
              
              <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å: –∫–æ–Ω—Ç–µ–Ω—Ç -->
              <div class="portal-card-content flex-grow-1 d-flex flex-column p-4">
                <!-- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤–≤–µ—Ä—Ö—É -->
                <div class="portal-card-meta d-flex align-items-center gap-2 mb-3">
                  <span class="text-secondary portal-meta-time">{{ post.created_at.strftime("%d.%m.%Y %H:%M") }}</span>
                  {% if post.categories %}
                    {% for c in post.categories[:1] %}
                      <span class="portal-meta-dot"></span>
                      <a href="{{ url_for('main.index', category=c.slug) }}" class="text-decoration-none text-secondary portal-meta-category-link" onclick="event.stopPropagation();">{{ c.title }}</a>
                    {% endfor %}
                  {% endif %}
                  {% if post.tags %}
                    {% for tag in post.tags[:3] %}
                      <span class="portal-meta-dot"></span>
                      <a href="{{ url_for('main.index', tag=tag.slug) }}" class="text-decoration-none text-secondary portal-meta-tag-link" onclick="event.stopPropagation();">#{{ tag.name }}</a>
                    {% endfor %}
                  {% endif %}
                  {% if not post.is_published %}
                    <span class="badge text-bg-warning flex-shrink-0 ms-auto">–°–∫—Ä—ã—Ç</span>
                  {% endif %}
                </div>
                
                <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
                <h3 class="h4 mb-0 fw-bold portal-card-title">
                  <a href="{{ url_for('main.post_detail', post_id=post.id) }}" class="text-decoration-none text-inherit">{{ post.title }}</a>
                </h3>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  {% endif %}

  <div class="d-flex flex-wrap align-items-center justify-content-between mt-4 mb-3 gap-2">
    <div class="d-flex align-items-center gap-2">
      <div class="h5 mb-0">–°–≤–µ–∂–∏–µ –ø–æ—Å—Ç—ã</div>
      <span class="badge text-bg-light border">–í—Å–µ–≥–æ: {{ posts|length }}</span>
    </div>
    {% if q %}
      <div class="text-secondary">–ü–æ–∏—Å–∫: <span class="text-light fw-semibold">{{ q }}</span></div>
    {% endif %}
  </div>

  {% if trending_posts %}
    <div class="portal-panel portal-glow p-3 p-lg-4 mb-3">
      <div class="d-flex align-items-center justify-content-between">
        <div class="fw-bold">üî• –û–±—Å—É–∂–¥–∞–µ–º–æ–µ</div>
        <a class="btn btn-sm btn-outline-light" href="{{ url_for('main.random_post') }}">üé≤ –°–ª—É—á–∞–π–Ω—ã–π –ø–æ—Å—Ç</a>
      </div>
      <div class="d-flex flex-wrap gap-2 mt-3">
        {% for t in trending_posts %}
          <a class="badge text-bg-light portal-pill text-decoration-none" href="{{ url_for('main.post_detail', post_id=t.id) }}">
            {{ t.cover_emoji or "‚ú®" }} {{ t.title[:64] }}{% if t.title|length > 64 %}‚Ä¶{% endif %}
          </a>
        {% endfor %}
      </div>
    </div>
  {% endif %}

  {% if not posts %}
    <div class="portal-empty p-4">
      <div class="fw-bold mb-1">–ü–æ–∫–∞ –ø—É—Å—Ç–æ</div>
      <div class="text-secondary">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π –ø–æ—Å—Ç.</div>
    </div>
  {% endif %}

  <!-- –õ–µ–Ω—Ç–∞ –ø–æ—Å—Ç–æ–≤ -->
  <div class="d-flex flex-column gap-3">
    {% for post in posts %}
      <div class="portal-card-horizontal position-relative">
        <div class="d-flex gap-0">
          <!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å: –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ —ç–º–æ–¥–∑–∏ -->
          <div class="portal-card-image-wrapper flex-shrink-0 position-relative">
            {% if post.media_path and post.media_type != "video" %}
              <img src="{{ url_for('static', filename=post.media_path) }}" alt="{{ post.title }}" class="portal-card-image">
            {% else %}
              <div class="portal-card-emoji-wrapper">
                <div class="portal-card-emoji">{{ post.cover_emoji or "‚ú®" }}</div>
              </div>
            {% endif %}
          </div>
          
          <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å: –∫–æ–Ω—Ç–µ–Ω—Ç -->
          <div class="portal-card-content flex-grow-1 d-flex flex-column p-4">
            <!-- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤–≤–µ—Ä—Ö—É -->
            <div class="portal-card-meta d-flex align-items-center gap-2 mb-3 flex-wrap">
              <span class="text-secondary portal-meta-time">{{ post.created_at.strftime("%d.%m.%Y %H:%M") }}</span>
              {% if post.categories %}
                {% for c in post.categories[:1] %}
                  <span class="portal-meta-dot"></span>
                  <a href="{{ url_for('main.index', category=c.slug) }}" class="text-decoration-none text-secondary portal-meta-category-link" onclick="event.stopPropagation();">{{ c.title }}</a>
                {% endfor %}
              {% endif %}
              {% if post.tags %}
                {% for tag in post.tags[:3] %}
                  <a href="{{ url_for('main.index', tag=tag.slug) }}" class="portal-meta-tag" onclick="event.stopPropagation();">#{{ tag.name }}</a>
                {% endfor %}
              {% endif %}
              {% if not post.is_published %}
                <span class="badge text-bg-warning flex-shrink-0 ms-auto">–°–∫—Ä—ã—Ç</span>
              {% endif %}
            </div>
            
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
            <h3 class="h4 mb-0 fw-bold portal-card-title">
              <a href="{{ url_for('main.post_detail', post_id=post.id) }}" class="text-decoration-none text-inherit">{{ post.title }}</a>
            </h3>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% endblock %}


